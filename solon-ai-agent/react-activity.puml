@startuml
skinparam shadowing false
skinparam activityBackgroundColor #E1F5FE
skinparam activityBorderColor #01579b

title ReActAgent 内部执行逻辑 (Activity Diagram)

start

:初始化 ReActTrace\n(记录初始 Prompt);

while (当前路由不是 ID_END?) is (继续执行)
    partition "ReasonTask (推理阶段)" {
        :检查执行步数 (MaxSteps);
        if (步数超限?) then (是)
            :设置路由为 ID_END;
            :生成错误 Final Answer;
        else (否)
            :调用 LLM 模型进行推理;
            :识别模型意图;
            if (识别到 Action / ToolCall?) then (是)
                :设置路由为 ID_ACTION;
            else (否)
                :设置路由为 ID_END;
                :提取最终答案 (Final Answer);
            endif
        endif
    }

    if (当前路由 == ID_ACTION?) then (执行工具)
        partition "ActionTask (动作阶段)" {
            :解析 Action 参数与工具名;
            :调用本地 FunctionTool;
            :获取 Observation (观察结果);
            :回填 Observation 到 Trace;
            :重置路由为 ID_REASON;
        }
    endif
endwhile (任务完成)

:输出最终结果;

stop
@enduml